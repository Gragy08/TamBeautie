extends ../layouts/default.pug

block main
  .row
    .col-12
      .card
        .card-header
          .row.align-items-center
            .col
              h4.card-title #{pageTitle}
            // end col
            .col-auto
              a.btn.btn-info.me-1(
                href=`/${pathAdmin}/contact/list/trash`
                )
                i.las.la-trash-alt.me-1
                | Thùng rác
              a.btn.btn-primary(
                href=`/${pathAdmin}/contact/create`
                )
                i.fa-solid.fa-plus.me-1
                | Tạo Liên hệ mới
          // end row
        // end card-header
        .card-body.pt-0
          .row
            .col-lg-6
              form.input-group.mb-3(form-search)
                input.form-control(
                  placeholder="Nhập SĐT..."
                  type="text"
                  name="keyword"
                  )
                button.btn.btn-secondary Tìm kiếm
          //- Table
          .table-responsive
            table.table.table-striped.mb-0
              thead.table-light
                tr
                  th STT
                  th Tên khách hàng
                  th Số điện thoại
                  th Ngày sinh nhật
                  th Dịch vụ gần đây
                  th Ngày khám gần đây
                  th.text-end Hành động
              tbody
                if(recordList.length > 0)
                  each item, index in recordList
                    - var latestBooking = null;
                    - if (Array.isArray(item.bookings) && item.bookings.length > 0) {
                    -   latestBooking = item.bookings.reduce(function(a, b) {
                    -     return new Date(a.date) > new Date(b.date) ? a : b;
                    -   });
                    - }
                    tr
                      td #{pagination.skip + index + 1}
                      td #{item.fullName}
                      td #{item.phone}
                      td #{item.dob}
                      td #{latestBooking ? latestBooking.name : '-'}
                      td #{latestBooking && latestBooking.date ? (new Date(latestBooking.date)).toLocaleDateString('vi-VN') : '-'}
                      //- td
                      //-   if (item.sex == "male")
                      //-     span.badge.bg-info Nam
                      //-   else if (item.sex == "female")
                      //-     span.badge.bg-pink Nữ
                      //-   else if (item.sex == "other")
                      //-     span.badge.bg-success Khác
                      td.text-end
                        a(href=`/${pathAdmin}/contact/view/${item._id}` style="font-size: 20px")
                          i.las.la-eye.text-info.font-16.me-1
                        a(href=`/${pathAdmin}/contact/edit/${item._id}` style="font-size: 20px")
                          i.las.la-pen.text-warning.font-16.me-1
                        a(
                          href="javascript:;"
                          button-api
                          data-method="PATCH"
                          data-api=`/${pathAdmin}/contact/delete/${item._id}`
                          style="font-size: 20px"
                          )
                          i.las.la-trash-alt.text-danger.font-16
                else
                  tr
                    td(colspan="6" class="text-center") Không tìm thấy dữ liệu
          .row.mt-3
            .col-lg-2.col-md-3.col-6
              select.form-select(pagination)
                - for (let i = 1; i <= pagination.totalPage; i++)
                  option(value=i) Trang #{i}
    // end col
